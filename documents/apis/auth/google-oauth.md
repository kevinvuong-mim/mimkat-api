# Google OAuth API Documentation

## Overview

API xác thực người dùng thông qua Google OAuth 2.0. Hỗ trợ cả Bearer tokens và HttpOnly cookies.

**Base URL**: `/auth`

**OAuth Flow**: Authorization Code Flow with PKCE

---

## Endpoints

### 1. Initiate Google OAuth (Bắt đầu đăng nhập Google)

Khởi tạo quá trình đăng nhập Google OAuth. Endpoint này sẽ redirect người dùng đến trang đăng nhập của Google.

**Endpoint**: `GET /auth/google`

**Authentication**: Không yêu cầu (Public)

#### Response

Endpoint này sẽ redirect người dùng đến Google OAuth consent screen. Không có JSON response.

#### Redirect Flow

1. User truy cập `/auth/google`
2. Backend redirect đến `https://accounts.google.com/o/oauth2/v2/auth` với các parameters:
   - `client_id`: Google OAuth Client ID
   - `redirect_uri`: `{BACKEND_URL}/auth/google/callback`
   - `response_type`: `code`
   - `scope`: `email profile`
3. User chọn tài khoản Google và cấp quyền
4. Google redirect về `/auth/google/callback` với authorization code

---

### 2. Google OAuth Callback (Xử lý callback từ Google)

Xử lý callback từ Google sau khi user cấp quyền. Tự động set cookies và redirect về frontend.

**Endpoint**: `GET /auth/google/callback`

**Authentication**: Không yêu cầu (Public - handled by Google)

#### Query Parameters (Auto-generated by Google)

| Parameter | Type   | Description                  |
| --------- | ------ | ---------------------------- |
| code      | string | Authorization code từ Google |
| scope     | string | Các scopes đã được cấp quyền |

#### Response

**Success (302 Redirect)**

Backend sẽ:

1. Set HttpOnly cookies với accessToken và refreshToken
2. Redirect về frontend với success status

```
{FRONTEND_URL}/auth/callback?success=true
```

**Response Headers (Set-Cookie)**:

```
Set-Cookie: accessToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; HttpOnly; Secure; SameSite=Strict; Max-Age=3600
Set-Cookie: refreshToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; HttpOnly; Secure; SameSite=Strict; Max-Age=604800
```

**Error Responses**

- **401 Unauthorized**: Google authentication failed

```json
{
  "success": false,
  "statusCode": 401,
  "message": "Google authentication failed",
  "error": "Unauthorized",
  "timestamp": "2025-11-12T10:00:00.000Z",
  "path": "/auth/google/callback"
}
```

- **401 Unauthorized**: Account bị vô hiệu hóa

```json
{
  "success": false,
  "statusCode": 401,
  "message": "Account has been disabled",
  "error": "Unauthorized",
  "timestamp": "2025-11-12T10:00:00.000Z",
  "path": "/auth/google/callback"
}
```

## Common Errors

### Invalid Client ID

**Error**: `redirect_uri_mismatch`

**Cause**: Redirect URI không match với Google Console config

**Solution**: Kiểm tra lại `GOOGLE_CALLBACK_URL` và Google Console settings

### User Cancelled

**Scenario**: User từ chối cấp quyền trên Google consent screen

**Solution**: User sẽ được redirect về trang login, không có authData

### Account Disabled

**Response**:

```json
{
  "success": false,
  "statusCode": 401,
  "message": "Account has been disabled",
  "error": "Unauthorized",
  "timestamp": "2025-11-12T10:00:00.000Z",
  "path": "/auth/google/callback"
}
```

**Solution**: Contact admin để kích hoạt lại tài khoản
